{% extends 'cd/index.html' %}

{% block title.content %}{{ titulo }} - {{ block.super }}{% endblock title.content %}
{% block header.content %}{{ titulo }} - <a href="{% url 'cd:index' %}">{{ block.super }}</a>{% endblock header.content %}

{% block stylesheet %}
<style>
{% include 'layout/simple_table.css' %}

thead th
{
  position: sticky;
  top: 0px;
}

</style>
{% endblock %}

{% block content %}
{% if msg_erro %}
  <h3>{{ msg_erro }}</h3>
{% endif %}
{% if form %}
<p><a title="Listar" href="{% url 'cd:solicitacoes' %}"><span class="glyphicon glyphicon-list" style="font-size: 2em" aria-hidden="true"></span></a></p>
  {% if id %}
    <h2>Edita Solicitação</h2>
    <form action="{% url 'cd:solicitacoes' id %}" method="post">
  {% else %}
    <h2>Adiciona Solicitação</h2>
    <form action="{% url 'cd:solicitacoes' 'add' %}" method="post">
  {% endif %}
  {% csrf_token %}
  {{ form.as_p }}
  {% if id %}
    <input type="submit" value="Grava"/>
  {% else %}
    <input type="submit" value="Adiciona"/>
  {% endif %}
  </form>
{% else %}
  <p><a title="Inserir" href="{% url 'cd:solicitacoes' 'add' %}"><span class="glyphicon glyphicon-plus-sign" style="font-size: 2em" aria-hidden="true"></span></a></p>
{% endif %}
{% if data %}
  <form action="{% url 'cd:solicitacoes' %}" method="post">
    {% csrf_token %}
    {{ filter.as_p }}
    <input type="submit" value="Busca"/>
  </form>
  <table>
    <thead>
      <tr>
        <th>
          &nbsp;
        </th>
        {% for field in fields %}
          <th>
            {{headers|get_item:field}}
          </th>
        {% endfor%}
      </tr>
    </thead>
    <tbody>
      {% for row in data %}
        <tr>
          <td>
            <a title="Editar" href="{% url 'cd:solicitacoes' row.id %}"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a>
          </td>
          {% for field in fields %}
            <td>
              {% if field == 'ativa' %}
                {% if row.ativa %}
                  <span class="glyphicon glyphicon-ok-circle" style="color: green" aria-hidden="true"></span>
                {% else %}
                  <span class="glyphicon glyphicon-ban-circle" style="color: red" aria-hidden="true"></span>
                {% endif %}
              {% else %}
                {% if row|get_item:field %}
                  {% with field|add:'|LINK' as field_link %}
                    {% if row|get_item:field_link %}
                      <a href="{{ row|get_item:field_link }}">{{row|get_item:field}}</a>
                    {% else %}
                      {{row|get_item:field}}
                    {% endif %}
                  {% endwith %}
                {% endif %}
              {% endif %}
            </td>
          {% endfor%}
        </tr>
      {% endfor%}
    </tbody>
  </table>
{% endif %}
{% endblock content %}
