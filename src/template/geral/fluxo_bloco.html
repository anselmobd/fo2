subgraph cluster_{{bloco.nome}} {
  label = <{{bloco.cabecalho|safe}}<br /><br />Alternativa {{bloco.alternativa.num}}: {{bloco.alternativa.descr}}<br />Roteiro {{bloco.roteiro.num}}: {{bloco.roteiro.descr}}>
  style=rounded
  {{bloco.nome}} [
    label = <
    <table BORDER="0" CELLPADDING="0" CELLSPACING="0">
    <tr cellpadding="0"><td><u>G</u> </td><td align="left"><u>Est√°gio</u></td><td><u>Dep.</u></td><td><u>Insumos</u></td></tr>
    {% for estagio_key, estagio_data in bloco.estagios.items %}
      {% with estagios|get_item:estagio_key as est %}
      <tr><td>{{estagio_data.0}}</td><td align="left">{{est.num}}-{{est.descr}}</td><td>{{est.deposito}}</td><td>{% if estagio_data.1 %}{% spaceless %}
        <table BORDER="1" CELLPADDING="0" CELLSPACING="0">
          {% for insumo in estagio_data.1 %}
            <tr><td BORDER="0">{{insumo|safe}}</td></tr>
          {% endfor %}
        </table>
        {% endspaceless %}{% else %}-{% endif %}</td></tr>
      {% endwith %}
    {% endfor %}
    </table>
    >
  ]
}
